<html>

<head>

<title>TESTGR</title>

{% load static %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.0/dist/semantic.min.css">

<style>
    .test_failed {
        color: red;
    }
</style>

</head>

<body>

<div class="ui grid">

    <div class="sixteen wide column">
        <div class="ui  menu">
            <div class="item">
                <h3><a href="{%  url 'index' %}">TESTGR</a></h3>
            </div>
            <a href="{%  url 'index' %}" class="item active">Monitoring</a>
            <a href="{%  url 'history' %}" class="item">History</a>
            <a href="{%  url 'management' %}" class="item">Management</a>
            <div class="right menu" id="main_right_menu">
                {% if running_jobs_count > 0 %}
                <div class="item" id="running_jobs_count">
                <span>Currently running jobs: <strong>{{ running_jobs_count }}</strong></span>
                </div>
                {% else %}
                <div class="" id="running_jobs_count">
                </div>
                {% endif %}
                <div class="item">
                    <a href="https://github.com/and-sm/testgr" target="_blank">Github</a>
                </div>
            </div>
        </div>
	</div>

    <div class="one wide column">
    </div>

    <div class="four wide column">
        <h3>Job Details</h3>
        <div class="ui divider"></div>
        <div><h5 id="job_status">Status:
            {% if status == 1 %}<span class="ui blue small header">In Progress</span>
            {% elif status == 2 %}<span class="ui green small header">Passed</span>
            {% elif status == 3 %}<span class="ui red small header">Failed</span>
            {% elif status == 4 %}<span class="ui yellow small header">Stopped</span>
            {% endif %}</h5>
        </div><br />
        {% if env != None %}<div><h5>Environment: &nbsp;<span class="ui middle label">{{ env|upper }}</span></h5></div><br />
        {% endif %}
        <div><h5>UUID: </h5>{{ uuid }}</div><br />
        <div><h5>Start Date: </h5>{{ start_time }}</div><br />
        <p><strong>Stop Date: </strong><br /><span id="job_stop_timestamp">{% if stop_time is not None %}{{ stop_time }}{% else %}Pending...{% endif %}</span></p>
        <p><strong>Time Taken: </strong><br /><span id="job_time_taken">{% if time_taken is not None %}{{ time_taken }}{% else %}Pending...{% endif %}</span></p>
        {% if status != 1 %}
            <div><h5>Chart:</h5></div>
            <div><canvas id="myChart" width="250" height="250"></canvas></div>
        {% endif %}
    </div>

    <div class="ten wide column">
        <div class="ui grid">
            <div class="eight wide column"><h3>Tests: {{ test_count }}</h3></div>
            <div class="eight wide column right aligned"><h3><div class="ui grey label">
                {% if fw == 1 %}nose2{% elif fw == 2 %}pytest{% else %}unknown type of tests{% endif %}</div></h3>
            </div>
        </div>

        <div class="ui horizontal segments">
            <div class="ui segment">
                <h4 id="job_tests_passed">Passed: {{ passed }}</h4>
            </div>
            <div class="ui segment">
                <h4 id="job_tests_failed">Failed: <span class="{% if failed > 0 %}test_failed{% else %}{% endif %}">{{ failed }}</span></h4>
            </div>
            <div class="ui segment">
                <h4 id="job_tests_aborted">Aborted: <span class="{% if aborted > 0 %}test_failed{% else %}{% endif %}">{{ aborted }}</span></h4>
            </div>
            <div class="ui segment">
                <h4 id="job_tests_skipped">Skipped: {{ skipped }}</h4>
            </div>
            <div class="ui segment">
                <h4 id="job_tests_not_started">Not Started: {{ not_started }}</h4>
            </div>
        </div>

        <div class="ui divider"></div>
        <table class="ui very basic table">
            <thead>
            <tr>
                <th>Test Method</th>
                <th>Start Time</th>
                <th>Time Taken</th>
                <th>Status</th>
            </tr>
            </thead>
            <tbody id="tests_list">
            {% for item in tests.all %}
                <tr>
                    {% if fw == 1 %}
                    <td><a href="{%  url 'test' test_uuid=item.uuid  %}" title="{{ item.identity }}">
                        {{ item.get_test_method_for_nose }}</a></td>
                    {% elif fw == 2 %}
                    <td><a href="{%  url 'test' test_uuid=item.uuid  %}" title="{{ item.identity }}">
                        {{ item.get_test_method_for_pytest }}</a></td>
                    {% endif %}
                    <td><a href="{%  url 'test' test_uuid=item.uuid  %}">
                        {% if item.get_start_time is not None %}
                            {{ item.get_start_time }}
                        {% else %}Pending...
                        {% endif %}
                    </a></td>
                    <td><a href="{%  url 'test' test_uuid=item.uuid  %}">
                        {% if item.get_time_taken is not None and item.status != 2 %}
                            {{ item.get_time_taken }}
                        {% elif item.get_time_taken_eta is not None and item.status == 2 %}
                            ETA: {{ item.get_time_taken_eta }}
                        {% else %}Pending...
                        {% endif %}
                    </a></td>
                    <td><a href="{%  url 'test' test_uuid=item.uuid  %}">
                        {% if item.status == 1%}<div class="ui gray basic label">Not Started</div>
                        {% elif item.status == 2%}<div class="ui blue basic label">In Progress</div>
                        {% elif item.status == 3%}<div class="ui green basic label">Passed</div>
                        {% elif item.status == 4 %}<span class="ui red basic label">Failed</span>
                        {% elif item.status == 5 %}<div class="ui yellow basic label">Skipped</div>
                        {% elif item.status == 6 %}<div class="ui red basic label">Aborted</div>
                        {% endif %}
                    </a></td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="one wide column">
    </div>

</div>

</body>

<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.0/dist/semantic.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>

<script>
    let passed = {{ passed }};
    let failed = {{ failed }};
    let aborted = {{ aborted }};
    let not_started = {{ not_started }};
    let skipped = {{ skipped }};
    data = {
    datasets: [{
        data: [passed, failed, aborted, skipped, not_started],
        backgroundColor:
            ["rgb(0, 166, 0)","rgb(200, 0, 0)","rgb(200, 0, 0)","rgb(255, 200, 0)","rgb(130, 130, 130)"]
    }],


    labels: [
        'Passed',
        'Failed',
        'Aborted',
        'Skipped',
        'Not Started'
    ]
};
$(document).ready(function() {
        var ctx = $("#myChart");
        var myDoughnutChart = new Chart(ctx, {
            type: 'doughnut',
            data: data,
            options: {
                responsive: false,
                legend: {
                    display: false,
                    labels: {
                        fontColor: 'rgb(255, 99, 132)'
                    }
                }
            }
        });

});
</script>


<script type="application/javascript" src="{% static 'js/testgr/main/running_jobs_count.js' %}"></script>
<script type="application/javascript" id="job_details" data-job-uuid="{{ uuid }}"
        src="{% static 'js/testgr/main/job_details.js' %}">
</script>
<script type="application/javascript" id="job_tests_details" data-job-uuid="{{ uuid }}"
        src="{% static 'js/testgr/main/job_tests_details.js' %}">
</script>
</html>